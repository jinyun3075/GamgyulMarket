<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form id="post-form">
        <input type="file" accept="image/*" name="image" id="image" multiple>
        <input type="text" name="" id="content">
        <button type="button" id="submit-btn">게시글 업로드</button>
    </form>
</body>
<script>
    const $image =document.querySelector("#image")
    const $content = document.querySelector("#content")
    const $submitBtn = document.querySelector("#submit-btn")
    const $postForm = document.querySelector("#post-form")
    //여기부터
    async function imageUpload(formData){
        const res = await fetch(`http://146.56.183.55:5050/image/uploadfiles`, {
            method: "POST",
            body : formData
        })
        const data = await res.json()
        const productImgName = data["filename"];
        return productImgName
    }
    async function createPost(e) {
        const url = "http://146.56.183.55:5050"
        const token = localStorage.getItem("Token")
        //입력한 텍스트 불러와야함
        const contentText = $content.value
        //여기는 나중에 이미지 주소가 추가될 예정
        const files = $image.files
        //file갯수를 판별하여 3개 이하일때만 실행하게한다.
        if (files.length<=3) {
            const formData = new FormData()
            // file을 입력한 갯수만큼 반복해서 실행합니다. 여기서 전송할 폼 데이터를 만듭니다!
            for (let index = 0; index < files.length; index++) {
                formData.append("image",files[index])
            }
            const imageUrl = await imageUpload(formData)
        }else{
            alert("아 이미지 갯수가 너무 많소")
        }
        
    }
    //여기까지 이미지 여러개 업로드하기.
    $submitBtn.addEventListener('click',createPost)
</script>
</html>