<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./css/reset.css">
  <link rel="stylesheet" href="./css/kmh_06_Chat_Room.css">
<title>Chat Room</title>
</head>
<body>
  <section class="m-container chatroom">
    <section class="top-chat-nav">
      <h2 class="blind">상단채팅네비게이션</h2>
      <div class="arrow"></div>
      <div class="text">애월읍 위니브 감귤농장</div>
      <div class="more"></div>
    </section>
    <div class="modal">채팅방 나가기</div>
    <section class="chat-container">
      <div class="you">
        <div class="pic"></div>
        <div class="chat">웃을 인생을 그러므로 없으면 것은 이상의 것은 우리의 위하여, 뿐이다. 이상의 청춘의 뼈 따뜻한 그들의 그와 악동하다. 대고, 못할 넣는 풍부하게 뛰노는 인생의 힘있다.</div>
        <div class="time"><span>12:39</span></div>
      </div>
      <div class="you">
        <div class="pic"></div>
        <div class="chat">안녕하세요. 감귤 사고싶어요요요요요</div>
        <div class="time"><span>12:41</span></div>
      </div>
      <div class="me">
        <div class="time"><span>12:50</span></div>
        <div class="chat">네 말씀하세요.</div>
        <div class="space"></div>
      </div>
      <div class="me">
        <div class="time"><span>12:51</span></div>
        <div class="chat"><img src="../img/smile.gif" height="220px" alt="이미지를 보냈습니다"></div>
        <div class="space"></div>
      </div>
    </section>
    <section class="comment">
      <h2 class="blind">코멘트</h2>
      <label class="icon" for="icon-file"></label>
      <input class="icon-file" type="file" accept="img/*" name="upload_image[]" multiple></input>
      <input class="text" placeholder="댓글 입력하기"></input>
      <div class="posting">전송</div>
    </section>
  </section>

  <script>

    // (1. 채팅구현)
    let posting = document.querySelector(".posting");
    let text = document.querySelector(".comment .text");
    let chat = document.querySelector(".chat-container");
    let imageboolean = false;
    
    posting.addEventListener('click', chatevent);
    text.addEventListener('keyup', chatevent_text);

    function chatevent_text(event) {
      // 엔터입력시 chatevent 호출
      if (event.key === 'Enter') {
        chatevent();
      }
    }
    function chatevent() {
      // 채팅메세지 객체
      let message = document.querySelector(".comment .text").value;
      console.log(message);
      // 현재시각 객체
      let now = new Date();
      let hours = now.getHours();
      let minutes = now.getMinutes();
      if (minutes < 11) {minutes = '0' + minutes;}; 
      // 채팅창 삽입하기
      const mymessage = document.createElement('div');
      if(imageboolean){
        mymessage.innerHTML = `
          <div class="time"><span>${hours}:${minutes}</span></div>
          <div class="chat"><img src=${text.value} height=auto alt="이미지를 보냈습니다"></div>
          <div class="space"></div>
        `;
      } else {
        mymessage.innerHTML = `
          <div class="time"><span>${hours}:${minutes}</span></div>
          <div class="chat">${message}</div>
          <div class="space"></div>
        `;
      }
      mymessage.classList.add('me');
      chat.appendChild(mymessage);
      // 채팅인풋 비우기
      text.value = '';
      document.querySelector(".posting").classList.remove('image');
      imageboolean = false; 
    }

    // (2. 모달창구현) 
    let modal = document.querySelector('.more');
    modal.addEventListener('click', modalevent);
    function modalevent(event) {
      document.querySelector('.modal').classList.toggle('modal-on');
    } 

    // (3. 이미지업로드구현)
    let icon = document.querySelector('.icon');
    let iconfile = document.querySelector('.icon-file');
    icon.addEventListener('click', iconevent);
    function iconevent(event) {
      iconfile.click();
    }
    iconfile.addEventListener('change', function (event) { 
      let data = event.target;
      let fileList = data.files;
      console.log(data);
      console.log(fileList); 
      console.log(fileList[0]);
      let reader = new FileReader();
      reader.readAsDataURL(event.target.files[0]);
      reader.onload = function (e) {
        console.log(reader.result);
        posting.classList.add('image'); 
        text.value = reader.result;
        imageboolean = true;
        text.focus();
      }
    })
  </script>
</body>
</html>